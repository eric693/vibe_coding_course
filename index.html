<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vibe Studio - 創造你的數位作品</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #1a1a2e;
            --secondary: #16213e;
            --accent: #e94560;
            --accent-light: #ff6b88;
            --text: #f4f4f4;
            --text-dim: #a0a0a0;
            --bg: #0f0f1e;
            --card: #1a1a2e;
            --border: rgba(233, 69, 96, 0.2);
        }

        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--bg);
            color: var(--text);
            overflow-x: hidden;
        }

        .font-display {
            font-family: 'Playfair Display', serif;
        }

        .grain {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0.03;
            z-index: 1000;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }

        .glow {
            box-shadow: 0 0 20px rgba(233, 69, 96, 0.3), 0 0 40px rgba(233, 69, 96, 0.1);
        }

        .spotlight {
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at var(--x, 50%) var(--y, 50%), rgba(233, 69, 96, 0.15) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
            transition: opacity 0.3s ease;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }

        .animate-float {
            animation: float 6s ease-in-out infinite;
        }

        .animate-fade-in-up {
            animation: fadeInUp 0.8s ease-out forwards;
        }

        .loading-shimmer {
            background: linear-gradient(90deg, transparent, rgba(233, 69, 96, 0.1), transparent);
            background-size: 1000px 100%;
            animation: shimmer 2s infinite;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: var(--secondary);
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 3px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: var(--accent-light);
        }

        textarea {
            resize: none;
        }

        .preview-frame {
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            background: white;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .code-block {
            background: var(--secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            line-height: 1.6;
            color: #a0a0a0;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 400px;
            overflow-y: auto;
        }

        .template-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .template-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(233, 69, 96, 0.3);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 20px rgba(233, 69, 96, 0.4);
        }

        .btn-secondary {
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: var(--secondary);
            border-color: var(--accent);
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: var(--accent) !important;
            box-shadow: 0 0 0 3px rgba(233, 69, 96, 0.1);
        }

        .modal-backdrop {
            backdrop-filter: blur(10px);
            background: rgba(15, 15, 30, 0.8);
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .spinner {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body>
    <div class="grain"></div>
    <div class="spotlight" id="spotlight"></div>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // 預設範本
        const templates = [
            {
                id: 'website',
                name: '網頁',
                icon: 'WEB',
                description: '建立現代化的網頁設計',
                prompt: '創建一個關於咖啡的單頁網站，包含首頁、關於我們、產品展示和聯絡資訊'
            },
            {
                id: 'presentation',
                name: '簡報',
                icon: 'PPT',
                description: '設計專業的演示文稿',
                prompt: '製作一份關於人工智慧趨勢的簡報，包含5張投影片'
            },
            {
                id: 'app',
                name: '應用程式',
                icon: 'APP',
                description: '開發互動式應用',
                prompt: '建立一個待辦事項管理應用，可以新增、刪除和標記完成任務'
            },
            {
                id: 'dashboard',
                name: '儀表板',
                icon: 'DATA',
                description: '打造數據視覺化介面',
                prompt: '設計一個銷售數據儀表板，顯示圖表和關鍵指標'
            },
            {
                id: 'landing',
                name: '落地頁',
                icon: 'LAND',
                description: '製作產品宣傳頁面',
                prompt: '創建一個 SaaS 產品的落地頁，強調功能和訂閱方案'
            },
            {
                id: 'custom',
                name: '自訂',
                icon: 'NEW',
                description: '從零開始創作',
                prompt: ''
            }
        ];

        function App() {
            const [prompt, setPrompt] = useState('');
            const [generatedCode, setGeneratedCode] = useState('');
            const [isGenerating, setIsGenerating] = useState(false);
            const [showPreview, setShowPreview] = useState(false);
            const [selectedTemplate, setSelectedTemplate] = useState(null);
            const [history, setHistory] = useState([]);
            const [showHistory, setShowHistory] = useState(false);
            const iframeRef = useRef(null);

            useEffect(() => {
                const handleMouseMove = (e) => {
                    const spotlight = document.getElementById('spotlight');
                    if (spotlight) {
                        const x = (e.clientX / window.innerWidth) * 100;
                        const y = (e.clientY / window.innerHeight) * 100;
                        spotlight.style.setProperty('--x', `${x}%`);
                        spotlight.style.setProperty('--y', `${y}%`);
                    }
                };

                window.addEventListener('mousemove', handleMouseMove);
                return () => window.removeEventListener('mousemove', handleMouseMove);
            }, []);

            useEffect(() => {
                const saved = localStorage.getItem('vibe_history');
                if (saved) {
                    setHistory(JSON.parse(saved));
                }
            }, []);

            const saveToHistory = (prompt, code) => {
                const newHistory = [{
                    id: Date.now(),
                    prompt,
                    code,
                    timestamp: new Date().toISOString()
                }, ...history].slice(0, 10);
                setHistory(newHistory);
                localStorage.setItem('vibe_history', JSON.stringify(newHistory));
            };

            const handleGenerate = async () => {
                if (!prompt.trim()) return;

                setIsGenerating(true);
                setShowPreview(false);

                try {
                    const response = await fetch('https://api.anthropic.com/v1/messages', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            model: 'claude-sonnet-4-20250514',
                            max_tokens: 4000,
                            messages: [{
                                role: 'user',
                                content: `你是一個專業的前端開發者。根據以下需求，生成完整的 HTML 代碼（包含 CSS 和 JavaScript）。
                                
要求：
1. 生成單一完整的 HTML 文件
2. CSS 使用 <style> 標籤內嵌
3. JavaScript 使用 <script> 標籤內嵌
4. 代碼要有設計感、現代化、可直接運行
5. 只輸出 HTML 代碼，不要有任何其他文字說明
6. 不要使用 markdown 格式的代碼區塊標記

需求：${prompt}

請直接輸出完整的 HTML 代碼：`
                            }]
                        })
                    });

                    const data = await response.json();
                    let code = data.content[0].text;
                    
                    // 清理代碼格式
                    code = code.replace(/```html\n?/g, '').replace(/```\n?/g, '').trim();
                    
                    setGeneratedCode(code);
                    saveToHistory(prompt, code);
                    setShowPreview(true);

                    // 更新 iframe
                    setTimeout(() => {
                        if (iframeRef.current) {
                            const iframe = iframeRef.current;
                            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                            iframeDoc.open();
                            iframeDoc.write(code);
                            iframeDoc.close();
                        }
                    }, 100);
                } catch (error) {
                    console.error('生成失敗:', error);
                    alert('生成過程發生錯誤，請稍後再試');
                } finally {
                    setIsGenerating(false);
                }
            };

            const handleTemplateSelect = (template) => {
                setSelectedTemplate(template);
                setPrompt(template.prompt);
            };

            const handleDownload = () => {
                const blob = new Blob([generatedCode], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'vibe-creation.html';
                a.click();
                URL.revokeObjectURL(url);
            };

            const handleCopy = () => {
                navigator.clipboard.writeText(generatedCode);
                alert('代碼已複製到剪貼簿！');
            };

            const loadFromHistory = (item) => {
                setPrompt(item.prompt);
                setGeneratedCode(item.code);
                setShowPreview(true);
                setShowHistory(false);
                
                setTimeout(() => {
                    if (iframeRef.current) {
                        const iframe = iframeRef.current;
                        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                        iframeDoc.open();
                        iframeDoc.write(item.code);
                        iframeDoc.close();
                    }
                }, 100);
            };

            return (
                <div className="min-h-screen relative z-10">
                    {/* Header */}
                    <header className="border-b border-gray-800 backdrop-blur-sm bg-black/30">
                        <div className="max-w-7xl mx-auto px-6 py-6 flex items-center justify-between">
                            <div className="flex items-center space-x-4">
                                <div className="w-12 h-12 rounded-xl bg-gradient-to-br from-red-500 to-pink-500 flex items-center justify-center text-xl font-bold glow">
                                    V
                                </div>
                                <div>
                                    <h1 className="text-3xl font-display font-bold tracking-tight">
                                        Vibe Studio
                                    </h1>
                                    <p className="text-sm text-gray-400 mt-1">創造你的數位作品</p>
                                </div>
                            </div>
                            <button
                                onClick={() => setShowHistory(!showHistory)}
                                className="btn-secondary px-6 py-3 rounded-xl font-medium"
                            >
                                歷史記錄
                            </button>
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="max-w-7xl mx-auto px-6 py-12">
                        {/* Templates Section */}
                        {!generatedCode && (
                            <div className="animate-fade-in-up mb-12">
                                <h2 className="text-2xl font-display font-semibold mb-6">
                                    選擇一個範本開始
                                </h2>
                                <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
                                    {templates.map((template, index) => (
                                        <div
                                            key={template.id}
                                            onClick={() => handleTemplateSelect(template)}
                                            className={`template-card p-6 rounded-xl bg-gradient-to-br from-gray-800 to-gray-900 border ${
                                                selectedTemplate?.id === template.id
                                                    ? 'border-red-500'
                                                    : 'border-gray-700'
                                            }`}
                                            style={{ animationDelay: `${index * 0.1}s` }}
                                        >
                                            <div className="text-sm font-bold mb-3 text-red-400">{template.icon}</div>
                                            <h3 className="font-semibold mb-2">{template.name}</h3>
                                            <p className="text-xs text-gray-400">{template.description}</p>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Input Section */}
                        <div className="animate-fade-in-up" style={{ animationDelay: '0.2s' }}>
                            <div className="bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl p-8 border border-gray-700 mb-8">
                                <label className="block text-lg font-semibold mb-4">
                                    描述你想創建的內容
                                </label>
                                <textarea
                                    value={prompt}
                                    onChange={(e) => setPrompt(e.target.value)}
                                    placeholder="例如：創建一個現代化的個人作品集網站，包含首頁、關於我、作品展示和聯絡表單..."
                                    className="w-full h-32 px-4 py-3 bg-gray-900 border border-gray-700 rounded-xl text-gray-100 placeholder-gray-500 custom-scrollbar"
                                    disabled={isGenerating}
                                />
                                <div className="flex items-center justify-between mt-6">
                                    <p className="text-sm text-gray-400">
                                        提示：描述越詳細，生成的結果越符合預期
                                    </p>
                                    <button
                                        onClick={handleGenerate}
                                        disabled={isGenerating || !prompt.trim()}
                                        className="btn-primary px-8 py-3 rounded-xl font-semibold disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2"
                                    >
                                        {isGenerating ? (
                                            <>
                                                <div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full spinner"></div>
                                                <span>生成中...</span>
                                            </>
                                        ) : (
                                            <>
                                                <span>開始創作</span>
                                            </>
                                        )}
                                    </button>
                                </div>
                            </div>
                        </div>

                        {/* Preview Section */}
                        {showPreview && generatedCode && (
                            <div className="animate-fade-in-up grid lg:grid-cols-2 gap-8" style={{ animationDelay: '0.3s' }}>
                                {/* Preview */}
                                <div>
                                    <div className="flex items-center justify-between mb-4">
                                        <h3 className="text-xl font-semibold">預覽</h3>
                                        <div className="flex space-x-2">
                                            <button
                                                onClick={handleCopy}
                                                className="btn-secondary px-4 py-2 rounded-lg text-sm"
                                            >
                                                複製代碼
                                            </button>
                                            <button
                                                onClick={handleDownload}
                                                className="btn-primary px-4 py-2 rounded-lg text-sm"
                                            >
                                                下載
                                            </button>
                                        </div>
                                    </div>
                                    <div className="preview-frame" style={{ height: '600px' }}>
                                        <iframe
                                            ref={iframeRef}
                                            className="w-full h-full"
                                            title="preview"
                                        />
                                    </div>
                                </div>

                                {/* Code */}
                                <div>
                                    <h3 className="text-xl font-semibold mb-4">原始碼</h3>
                                    <div className="code-block custom-scrollbar" style={{ height: '600px' }}>
                                        {generatedCode}
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>

                    {/* History Modal */}
                    {showHistory && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center modal-backdrop" onClick={() => setShowHistory(false)}>
                            <div className="bg-gray-900 rounded-2xl p-8 max-w-2xl w-full mx-4 border border-gray-700 max-h-[80vh] overflow-y-auto custom-scrollbar" onClick={(e) => e.stopPropagation()}>
                                <div className="flex items-center justify-between mb-6">
                                    <h2 className="text-2xl font-display font-semibold">歷史記錄</h2>
                                    <button
                                        onClick={() => setShowHistory(false)}
                                        className="text-gray-400 hover:text-white"
                                    >
                                        ✕
                                    </button>
                                </div>
                                {history.length === 0 ? (
                                    <p className="text-gray-400 text-center py-8">尚無歷史記錄</p>
                                ) : (
                                    <div className="space-y-4">
                                        {history.map((item) => (
                                            <div
                                                key={item.id}
                                                onClick={() => loadFromHistory(item)}
                                                className="p-4 bg-gray-800 rounded-xl border border-gray-700 cursor-pointer hover:border-red-500 transition-colors"
                                            >
                                                <p className="text-sm text-gray-300 mb-2">{item.prompt}</p>
                                                <p className="text-xs text-gray-500">
                                                    {new Date(item.timestamp).toLocaleString('zh-TW')}
                                                </p>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    {/* Footer */}
                    <footer className="border-t border-gray-800 mt-20">
                        <div className="max-w-7xl mx-auto px-6 py-8 text-center text-gray-400 text-sm">
                            <p>Powered by Claude AI · 用創意點亮數位世界</p>
                        </div>
                    </footer>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>